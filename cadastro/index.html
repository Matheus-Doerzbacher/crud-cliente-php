<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cadastro de Cliente</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="../css/styles.css" />
  </head>
  <body>
    <div class="container">
      <div class="form-section">
        <h2>Cadastro de Cliente</h2>
        <form id="cadastro-form" style="width: 100%" enctype="multipart/form-data">
          <div class="form-row">
            <div>
              <label for="nome">Nome: <span class="obrigatorio">*</span></label>
              <input
                type="text"
                id="nome"
                name="nome"
                required
                placeholder="John"
              />
            </div>
            <div>
              <label for="sobrenome"
                >Sobrenome: <span class="obrigatorio">*</span></label
              >
              <input
                type="text"
                id="sobrenome"
                name="sobrenome"
                required
                placeholder="Doe"
              />
            </div>
          </div>

          <div class="form-row">
            <div>
              <label for="cpf">CPF: <span class="obrigatorio">*</span></label>
              <input
                type="text"
                id="cpf"
                name="cpf"
                required
                placeholder="000.000.000-00"
              />
            </div>
            <div>
              <label for="rg">RG:</label>
              <input
                type="text"
                id="rg"
                name="rg"
                required
                placeholder="00.000.000-0"
              />
            </div>
          </div>

          <div class="form-row">
            <div>
              <label for="email"
                >Email: <span class="obrigatorio">*</span></label
              >
              <input
                type="email"
                id="email"
                name="email"
                required
                placeholder="youremail@gmail.com"
              />
            </div>
            <div>
              <label for="telefone">Telefone:</label>
              <input
                type="text"
                id="telefone"
                name="telefone"
                required
                placeholder="(99) 99999-9999"
              />
            </div>
          </div>

          <div class="form-row">
            <div>
              <label for="senha"
                >Senha: <span class="obrigatorio">*</span></label
              >
              <input
                type="password"
                id="senha"
                name="senha"
                required
                placeholder="4+ characters"
              />
            </div>
            <div>
              <label for="confir-senha"
                >Confirmar Senha: <span class="obrigatorio">*</span></label
              >
              <input
                type="password"
                id="confir-senha"
                name="confir-senha"
                required
                placeholder="4+ characters"
              />
            </div>
          </div>

          <div class="form-row">
            <div>
              <label for="ce">CEP <span class="obrigatorio">*</span></label>
              <div style="display: flex; flex-direction: row">
                <input
                  type="text"
                  id="cep"
                  name="cep"
                  required
                  placeholder="00000-000"
                />
                <button
                  type="button"
                  onclick="consultaCEP()"
                  style="margin-left: 10px; height: 37px"
                >
                  Buscar CEP
                </button>
              </div>
            </div>
            <div>
              <label for="endereco"
                >Endereço: <span class="obrigatorio">*</span></label
              >
              <input
                type="text"
                id="endereco"
                name="endereco"
                required
                placeholder="Rua das Flores"
              />
            </div>
          </div>

          <div class="form-row">
            <div>
              <label for="numero">Numero:</label>
              <input type="text" id="numero" name="numero" placeholder="123" />
            </div>
            <div>
              <label for="bairro">Bairro:</label>
              <input
                type="text"
                id="bairro"
                name="bairro"
                required
                placeholder="Centro"
              />
            </div>
          </div>

          <div class="form-row">
            <div>
              <label for="cidade"
                >Cidade:</label
              >
              <input type="text" id="cidade" name="cidade" />
            </div>
            <div>
              <label for="estado">Estado:</label>
              <input type="text" id="estado" name="estado" />
            </div>
          </div>

          <div
            style="display: flex; flex-direction: column; margin-bottom: 20px"
          >
            <label for="imagem">Foto de Perfil</label>
            <input type="file" id="imagem" name="imagem" accept="image/*" />
          </div>

          <button type="button" id="cadastro-button" onclick="cadastrar()">
            Cadastrar
          </button>

          <div class="login-area">
            <p class="login-text">Já possui uma conta?</p>
            <button
              class="login-button"
              type="button"
              onclick="window.location.href='../login/index.html'"
              ;
            >
              Entrar
            </button>
          </div>
        </form>
        <div id="result" style="color: red"></div>
      </div>
    </div>

    <script type="text/javascript">
      function consultaCEP() {
        var cep = document.getElementById('cep');

        url = 'https://viacep.com.br/ws/' + cep.value + '/json/';
        fetch(url)
          .then(response => response.json())
          .then(result => {
            console.log(result);
            document.getElementById('cidade').value = result.localidade;
            document.getElementById('estado').value = result.estado;
          })
          .catch(error => {
            alert('CEP não encontrado');
          });
      }

      function cadastrar() {
        if (!validarCampos()) {
          return;
        }

        var formData = new FormData(document.getElementById('cadastro-form'));

        $.ajax({
          url: 'cadastro_usuario.php',
          type: 'post',
          data: formData,
          processData: false,
          contentType: false,
          success: function (response) {
            if (response.includes('sucesso')) {
              window.location.href = '../login/index.html';
            } else {
              console.log(response);
            }
          },
          error: function (xhr, status, error) {
            console.log('Erro ao cadastrar: ' + error);
          }
        });
      }

      function validarCampos() {
        var nome = document.getElementById('nome');
        var sobrenome = document.getElementById('sobrenome');
        var cpf = document.getElementById('cpf');
        var rg = document.getElementById('rg');
        var email = document.getElementById('email');
        var telefone = document.getElementById('telefone');
        var senha = document.getElementById('senha');
        var confirSenha = document.getElementById('confir-senha');
        var cep = document.getElementById('cep');
        var endereco = document.getElementById('endereco');
        var numero = document.getElementById('numero');
        var bairro = document.getElementById('bairro');
        var cidade = document.getElementById('cidade');
        var estado = document.getElementById('estado');
        var imagem = document.getElementById('imagem');
        
        if (nome.value == '') {
          nome.focus();
          return false;
        }

        if (sobrenome.value == '') {
          sobrenome.focus();
          return false;
        }

        if (cpf.value == '') {
          cpf.focus();
          return false;
        }

        if (rg.value == '') {
          rg.focus();
          return false;
        }

        if (email.value == '') {
          email.focus();
          return false;
        }
        if (telefone.value == '') {
          telefone.focus();
          return false;
        }

        if (senha.value == '') {
          senha.focus();
          return false;
        }

        if (confirSenha.value == '') {
          confirSenha.focus();
          return false;
        }

        if (senha.value != confirSenha.value) {
          alert('Senhas não conferem');
          senha.focus();
          return false;
        }

        if (cep.value == '') {
          cep.focus();
          return false;
        }

        if (endereco.value == '') {
          endereco.focus();
          return false;
        }

        if (cidade.value == '') {
          cidade.focus();
          return false;
        }

        if (estado.value == '') {
          estado.focus();
          return false;
        }

        return true;
      }
    </script>
  </body>
</html>
