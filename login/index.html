<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cadastro de Cliente</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="../css/styles.css"/>
  </head>
  <body>
    <div class="container">
      <div class="form-section">
        <h2>Cadastro de Cliente</h2>
        <form id="cadastro-form" style="width: 100%" onsubmit="validar()" method="POST">

          <div class="form-row">
            <div>
              <label for="email">Email:</label>
              <input
                type="email"
                id="email"
                name="email"
                required
                placeholder="youremail@gmail.com"
              />
            </div>
          </div>

          <div class="form-row">
            <div>
              <label for="senha">Senha:</label>
              <input
                type="password"
                id="senha"
                name="senha"
                required
                placeholder="4+ characters"
              />
            </div>

          <button type="submit" id="cadastro-button">Entrar</button>

          <div class="login-area">
            <p class="login-text">Ainda não possui uma conta?</p>
            <button
              class="login-button"
              type="button"
              onclick="window.location.href='../cadastro/index.html'";
            >
              Cadastrar
            </button>
          </div>
        </form>
        <div id="result" style="color: red"></div>
      </div>
    </div>

    <script type="text/javascript">
      function consultaCEP() {
        var cep = document.getElementById('cep');

        url = 'https://viacep.com.br/ws/' + cep.value + '/json/';
        fetch(url)
          .then(response => response.json())
          .then(result => {
            console.log(result);
            document.getElementById('endereco').value = result.logradouro;
            document.getElementById('bairro').value = result.bairro;
            document.getElementById('cidade').value = result.localidade;
            document.getElementById('estado').value = result.estado;
          })
          .catch(error => {
            alert('CEP não encontrado');
          });
      }

      function validar(event) {
        event.preventDefault();
        var nome = document.getElementById('nome');
        var sobrenome = document.getElementById('sobrenome');
        var cpf = document.getElementById('cpf');
        var rg = document.getElementById('rg');
        var email = document.getElementById('email');
        var telefone = document.getElementById('telefone');
        var senha = document.getElementById('senha');
        var confirSenha = document.getElementById('confir-senha');
        var cep = document.getElementById('cep');
        var endereco = document.getElementById('endereco');
        var numero = document.getElementById('numero');
        var bairro = document.getElementById('bairro');
        var cidade = document.getElementById('cidade');
        var estado = document.getElementById('estado');
        var imagem = document.getElementById('imagem');

        $.ajax({
          url: 'cadastro_usuario.php',
          type: 'post',
          data: {
            nome: nome.value,
            sobrenome: sobrenome.value,
            cpf: cpf.value,
            rg: rg.value,
            email: email.value,
            telefone: telefone.value,
            senha: senha.value,
            confirSenha: confirSenha.value,
            cep: cep.value,
            endereco: endereco.value,
            numero: numero.value,
            bairro: bairro.value,
            cidade: cidade.value,
            estado: estado.value
          },
          success: function (response) {
            if (response.includes('sucesso')) {
              window.location.href = '../login/index.html';
            } else {
              results.innerHTML = response;
            }
          },
          error: function (xhr, status, error) {
            results.innerHTML = 'Erro ao cadastrar: ' + error;
          }
        });
      }
    </script>
  </body>
</html>
